{% extends "home/base.html" %}
{% load staticfiles %}

{% block addon_css %}
    <link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
{% endblock %}


{% block addon_js %}
  <script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script>

<script type="text/javascript">

    dynamine_data = {{rs_annotations|safe}};
    
    $( document ).ready(function() {
        console.log( "ready!" );
        $( ".adddynamine_nterm" ).each(function( index ) {
          // console.log( index + ": " + $( this ).attr('entryname'));
          entry_name = $( this ).attr('entryname').split("_").slice(0, 2).join('_');
          // console.log(entry_name);
          cut = $( this ).attr('entryname').split("_").slice(-1);
          // console.log( index + ": " + entry_name + ' ' + cut);
          pos = $( this ).attr('position');
          if (pos>0) {
              test = dynamine_data[entry_name];
              d = dynamine_data[entry_name]['N-term'];
              length = Object.keys(d).length;
              seq_pos = length-pos+1;
              a = d[seq_pos];
              if (a<0.7) {
                // disordered / flexible
                color = 'green';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#99C799';
              } else if (a>0.8) {
                // ordered / rigid
                color = 'blue';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#999DFF';
              } else {
                color = 'red';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#FFA3A3';
              }
              // console.log( index + ": " + entry_name + ' pos:' + pos + ' seq_pos:' + seq_pos + ' ' +a);
              $(this).html("<font size=1 color='"+color+"'></font>");
              // if ($(this).attr('bgcolor')=='lightgrey') $(this).css('opacity',0.4);
              $(this).attr('bgcolor',color);
          }
        });
        $( ".adddynamine_cterm" ).each(function( index ) {
          // console.log( index + ": " + $( this ).attr('entryname'));
          entry_name = $( this ).attr('entryname').split("_").slice(0, -1).join('_');
          cut = $( this ).attr('entryname').split("_").slice(-1);
          // console.log( index + ": " + entry_name + ' ' + cut);
          pos = $( this ).attr('position');
          if (pos>0) {
              test = dynamine_data[entry_name];
              d = dynamine_data[entry_name]['C-term'];
              length = Object.keys(d).length;
              seq_pos = Object.keys(d)[pos-1];
              a = d[seq_pos];
              if (a<0.7) {
                // disordered / flexible
                color = 'green';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#99C799';
              } else if (a>0.8) {
                // ordered / rigid
                color = 'blue';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#999DFF';
              } else {
                color = 'red';
                if ($(this).attr('bgcolor')=='lightgrey') color = '#FFA3A3';
              }
              // console.log( index + ": " + entry_name + ' pos:' + pos + ' seq_pos:' + seq_pos + ' ' +a);
              $(this).html("<font size=1 color='"+color+"'></font>");
              // if ($(this).attr('bgcolor')=='lightgrey') $(this).css('opacity',0.4);
              $(this).attr('bgcolor',color);
          }
        });

    $('.table-nterm').DataTable( 
      {
          "paging":   false,
          "ordering": true,
          "info":     false,
          "searching": false,
          "order": [],
          columnDefs: [
            { targets: 'no-sort', orderable: false }
          ]
      } 
    ); 

    $('.table-nterm').css("width","");

    });

    $("input[name=display_type]").change(function () {
      $(".figure").hide();
      console.log("show","."+this.value);
      $("."+this.value).show();
    });

</script>
{% endblock %}

{% block content %}

<style type="text/css">


.verticalTableHeader {
    text-align:center;
    white-space:nowrap;
    transform: rotate(90deg);
}
.table-nterm > thead > tr > .verticalTableHeader {
    border-bottom: 0px;
}
.verticalTableHeader p {
    margin:0 -999px;/* virtually reduce space needed on width to very little */
    display:inline-block;
}
.verticalTableHeader p:before {
    content:'';
    width:0;
    padding-top:110%;
    /* takes width as reference, + 10% for faking some extra padding */
    display:inline-block;
    vertical-align:middle;
}
table {
    text-align:center;
}

.table-nterm {
    font-size: 10px;
    padding: 0px;
    table-layout: fixed;
    border-collapse: collapse;
    border-spacing: 0px;
    float: right;
    display: block;
}
.table-nterm > tbody > tr > td{
    padding: 0px;
    width: 2px;
}

.table-nterm > thead > tr > .seq_pos {
  padding:0px;
  width: 1px;
  text-align:center;
}

.table-nterm > thead > tr > .seq_pos2 {
  padding:0px;
  width: 10px;
  text-align:center;
}

.table-nterm > tbody > td {
  padding:0px;
  text-align:center;
}
.table-nterm > tfoot > tr > .seq_pos  {
  padding:0px;
  width: 1px;
  text-align:center;
}

.species_HUMAN {
  color: grey;
}

table.dataTable {
  width: auto;
}
.table-cterm {
    float: left;
}

.table-cterm > tbody > tr > td{
    padding: 0px;
    width: 6px;
}

.figure {
  display: none;
}
</style>
<br>
<br>
<h2> Construct Statistics</h2>


<div class="btn-group" data-toggle="buttons">

    <label class="btn btn-default active form-check-label">
        <input name="display_type" value='truncations' class="form-check-input" type="radio" autocomplete="off"> Truncations
    </label>

    <label class="btn btn-default form-check-label">
        <input name="display_type" value='fusions'  class="form-check-input" type="radio" autocomplete="off"> Fusions
    </label>

    <label class="btn btn-default form-check-label">
        <input name="display_type"  value='loopdeletions' class="form-check-input" type="radio" autocomplete="off"> Loop deletions (without fusion)
    </label>


    <label class="btn btn-default form-check-label">
        <input name="display_type" value='mutations'  class="form-check-input" type="radio" autocomplete="off"> Mutations
    </label>

    <label class="btn btn-default form-check-label">
        <input name="display_type"  value='old' class="form-check-input" type="radio" autocomplete="off"> Old
    </label>


</div>


<div class='figure truncations'>
  N-terminal truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.nterm.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe">
  <thead>
    <tr><th colspan={{values.range|length}}></th><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th></tr>
    <tr>
      {% for pos in values.range reversed %}
      <th class="seq_pos"></th>
      {% endfor %}
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th>
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      {% for pos in values.range reversed %}
          {% if pos in t_pos.0 %}
                  <td class='adddynamine_nterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='green' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='adddynamine_nterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='red' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='adddynamine_nterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='blue' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='adddynamine_nterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='blue' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td class='adddynamine_nterm' entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='white' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td>
      </tr>
  {% endfor %}
      </tbody>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>

  <br>
  C-terminal truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.cterm.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe table-cterm">
  <thead>
    <tr><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th><th colspan={{values.range|length}}></th></tr>
    <tr>
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th>
      {% for pos in values.range  %}
      <th class="seq_pos"></th>
      {% endfor %}
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td>
      {% for pos in values.range %}
          {% if pos in t_pos.0 %}
                  <td class='adddynamine_cterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='green' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='adddynamine_cterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='red' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='adddynamine_cterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='blue' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='adddynamine_cterm' entryname='{{recp}}' position='{{pos}}'  bgcolor='blue' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td class='adddynamine_cterm' entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='white' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      </tr>
  {% endfor %}
      </tbody>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>
</div>

<div class='figure fusions'>
  N-terminal truncations sites by class and residue position (In presense of N-term FUSION)
  <div>
  {% for class, values in truncations_new.nterm_fusion.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe">
  <thead>
    <tr><th colspan={{values.range|length}}></th><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th><th colspan={{values.fusions|length}}></th></tr>
    <tr>
      {% for pos in values.range reversed %}
      <th class="seq_pos2 no-sort verticalTableHeader">{{pos}}</th>
      {% endfor %}
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th>

      {% for fusion, number in values.fusions.items %}
      <th>{{fusion}}</th>
      {% endfor %}
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      {% for pos in values.range reversed %}
          {% if pos in t_pos.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}' bgcolor='white' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='white' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td>

      {% for fusion, number in values.fusions.items %}
        {% if fusion in t_pos.9 %}
            <td>&#x25C9;</td>
        {% else %}
            <td></td>
        {% endif %}
      {% endfor %}

      </tr>
  {% endfor %}
      </tbody>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>


  Fusion start (ICL3) truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.icl3_fusion_start.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe table-cterm">
  <thead>
    <tr><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th><th colspan={{values.fusions|length}}></th><th colspan={{values.range|length}}></th></tr>
    <tr>
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th><th>Linker</th>

      {% for fusion, number in values.fusions.items %}
      <th>{{fusion}}</th>
      {% endfor %}

      {% for pos in values.range  %}
      <th class="seq_pos no-sort verticalTableHeader">{{pos}}</th>
      {% endfor %}
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td><td>{{t_pos.10}}</td>
      
      {% for fusion, number in values.fusions.items %}
        {% if fusion in t_pos.9 %}
            <td>&#x25C9;</td>
        {% else %}
            <td></td>
        {% endif %}
      {% endfor %}


      {% for pos in values.range %}
          {% if pos in t_pos.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='white' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      </tr>
  {% endfor %}
      </tbody>
      <tfoot>
        <tr><th>Freq.</th><th colspan="7"></th>
        {% for fusion, number in values.fusions.items %}
          <th class="seq_pos">{{number}}</th>
        {% endfor %}

        {% for sum in values.sum  %}
            <th class="seq_pos">{{sum}}</th>
        {% endfor %}
        </tr>
      </tfoot>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>

  Fusion end (ICL3) truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.icl3_fusion_end.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe table-cterm">
  <thead>
    <tr><th colspan={{values.range|length}}></th><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th><th colspan={{values.fusions|length}}></th></tr>
    <tr>
      {% for pos in values.range  %}
      <th class="seq_pos no-sort verticalTableHeader">{{pos}}</th>
      {% endfor %}
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th><th>Linker</th>

      {% for fusion, number in values.fusions.items %}
      <th>{{fusion}}</th>
      {% endfor %}
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      {% for pos in values.range %}
          {% if pos in t_pos.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='white' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='lightgrey' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td><td>{{t_pos.10}}</td>
      {% for fusion, number in values.fusions.items %}
        {% if fusion in t_pos.9 %}
            <td>&#x25C9;</td>
        {% else %}
            <td></td>
        {% endif %}
      {% endfor %}

      </tr>
  {% endfor %}
      </tbody>
      <tfoot>
        <tr>
        {% for sum in values.sum  %}
            <th class="seq_pos">{{sum}}</th>
        {% endfor %}
        <th>Freq.</th><th colspan="7"></th>
        {% for fusion, number in values.fusions.items %}
          <th class="seq_pos">{{number}}</th>
        {% endfor %}
        </tr>
      </tfoot>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>

  Fusion start (ICL2) truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.icl2_fusion_start.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe table-cterm">
  <thead>
    <tr><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th></tr>
    <tr>
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th>
      {% for pos in values.range  %}
      <th class="seq_pos no-sort verticalTableHeader">{{pos}}</th>
      {% endfor %}
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td>
      {% for pos in values.range %}
          {% if pos in t_pos.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td class='' entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='white' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      </tr>
  {% endfor %}
      </tbody>
      <tfoot>
        <tr><th>Freq.</th><th colspan="7"></th>
        {% for sum in values.sum  %}
            <th class="seq_pos">{{sum}}</th>
        {% endfor %}
        </tr>
      </tfoot>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>

  Fusion end (ICL2) truncations sites by class and residue position
  <div>
  {% for class, values in truncations_new.icl2_fusion_end.items %}
  <div class="row">
      <div class="col-md-12">
  <table border=0 cellpadding=0 cellspacing=0 class="table-nterm stripe table-cterm">
  <thead>
    <tr><th colspan={{values.range|length}}></th><th colspan=2>{{class}}</th><th></th><th colspan=3>No. PDBs each state</th><th colspan=3></th></tr>
    <tr>
      {% for pos in values.range  %}
      <th class="seq_pos no-sort verticalTableHeader">{{pos}}</th>
      {% endfor %}
      <th>GPCR</th><th width=40>Name</th><th>Species</th><th>Ina</th><th>Int</th><th>Act</th><th>Cut</th><th>PDB</th>
    </tr>
  </thead>
      <tbody>
      {% for recp, t_pos in values.receptors.items %}
      <tr>
      {% for pos in values.range %}
          {% if pos in t_pos.0 %}
                  <td entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos in t_pos.1 %}
                  <td entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos < t_pos.0.0 %}
                  <td entryname='{{recp}}' position='{{pos}}'  bgcolor='white' align='center' style='border: none;'></td>
          {% elif pos < t_pos.1.0 %}
                  <td entryname='{{recp}}' position='{{pos}}'  bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% elif pos <= t_pos.2.0 %}
                  <td entryname='{{recp}}' position='{{pos}}' bgcolor='lightgrey' align='center' style='border: none;'></td>
          {% else %}
              <td bgcolor='lightgrey' style='border: none;'></td>
          {% endif %}
      {% endfor %}
      <td>{{t_pos.4}}</td><td>{{t_pos.8|safe}}</td><td class='species_{{t_pos.5}}'>{{t_pos.5}}</td><td>{{t_pos.6.inactive}}</td><td>{{t_pos.6.intermediate}}</td><td>{{t_pos.6.active}}</td><td>{{t_pos.7}}</td><td>{{t_pos.3|length}}</td>
      </tr>
  {% endfor %}
      </tbody>
      <tfoot>
        <tr>
        {% for sum in values.sum  %}
            <th class="seq_pos">{{sum}}</th>
        {% endfor %}
        <th>Freq.</th><th colspan="7"></th>
        </tr>
      </tfoot>
  </table>
      </div>
  </div>
  {% endfor %}
  </div>

</div>

<div class='figure mutations'>

  <br>
  Supplementary Table StabMutAASubst. Frequencies (no. GPCRs) of mutant amino acid substitutions across all positions of the receptor sequences/structures.
  <table border=1>
  <tr><th>WT / MUT</th>
  {% for aa,vals in mutation_matrix.items %}
  <th width=25 style="text-align: center;">{{aa}}</th>
  {% endfor %}
  <th width=25 style="text-align: center;">WT SUM</th>
  </tr>
  {% for aa,vals in mutation_matrix.items %}
  <tr>
  <th width=25 style="text-align: center;">{{aa}}</th>
  {% for aa,vals2 in vals.items %}
  <td width=25 style="text-align: center;background: rgba(255,0,0,  {{vals2.0}})">{{vals2.1}}</td>
  {% endfor %}
  </tr>
  {% endfor %}
  <tr>
  <th width=25 style="text-align: center;">MUT AA</th>
  {% for aa,vals2 in mutation_matrix_sum_mut.items %}
  <td width=25 style="text-align: center;background: rgba(255,0,0,  {{vals2.0}})">{{vals2.1}}</td>
  {% endfor %}
  </tr>
  </table>
</div>

<div class='figure old'>
  <br>
  Supplementary Table FusionSites (and loop deletion sites, typically active state structures) 
  <table width="1800" border=1>
  <tr><th colspan=3>Classification</th><th>GPCR</th>
  <th colspan={{truncations_new_possibilties.nterm_fusion|length}}>N-term</th>
  <th> </th>
  <th colspan={{truncations_new_possibilties.icl2_fusion_start|length}}>ICL2 Start</th>
  <th> Length </th>
  <th> No Aas </th>
  <th colspan={{truncations_new_possibilties.icl2_fusion_end|length}}>ICL2 End</th>
  <th> </th>
  <th colspan={{truncations_new_possibilties.icl3_fusion_start|length}}>ICL3 Start</th>
  <th> Length </th>
  <th> No Aas </th>
  <th colspan={{truncations_new_possibilties.icl3_fusion_end|length}}>ICL3 End</th>
  </tr>
  <tr><th width=120>Class</th><th>Lig</th><th>Rec</th><th>Entry name</th>
  {% for pos in truncations_new_possibilties.nterm_fusion reversed %}
  <th width=25 class="verticalTableHeader" style="text-align: center;"><p>{{pos}}</p></th>
  {% endfor %}
  <th> </th>
  {% for pos in truncations_new_possibilties.icl2_fusion_start %}
  <th width=25 class="verticalTableHeader" style="text-align: center;"><p>{{pos}}</p></th>
  {% endfor %}
  <th> 3x50-4x50 </th>
  <th> Deleted </th>
  {% for pos in truncations_new_possibilties.icl2_fusion_end %}
  <th width=25 class="verticalTableHeader" style="text-align: center;"><p>{{pos}}</p></th>
  {% endfor %}
  <th> </th>
  {% for pos in truncations_new_possibilties.icl3_fusion_start %}
  <th width=25 class="verticalTableHeader" style="text-align: center;"><p>{{pos}}</p></th>
  {% endfor %}
  <th> 5x50-6x50 </th>
  <th> Deleted </th>
  {% for pos in truncations_new_possibilties.icl3_fusion_end %}
  <th width=25 class="verticalTableHeader" style="text-align: center;"><p>{{pos}}</p></th>
  {% endfor %}
  </tr>
  {% for class, values in test.items %}
      {% for recp, vals in values.items %}
          <tr><td>{{class}}</td><td></td><td></td><td>{{recp}}</td>
          {% for pos in vals.for_print %}
              {% if pos == 'C' %}
                  <td bgcolor='green' align='center'>C</td>
              {% elif pos > 0 %}
                  <td bgcolor='red' align='center'>{{pos}}</td>
              {% else %}
                  <td></td>
              {% endif %}
          {% endfor %}
          </tr>
      {% endfor %}
  {% endfor %}
  {% for class, values in track_fusion_sums.items %}
      <tr><td>{{class}}</td><td></td><td></td><td>Sum</td>
      {% for pos, vals in values.items %}
          {% if vals != 0 %}
              <td>{{vals}}</td>
          {% else %}
              <td> </td>
          {% endif %}
      {% endfor %}
      </tr>
  {% endfor %}
  {% for fus, vals in test2.items %}
      <tr><td> - </td><td></td><td></td><td>{{fus}}</td>
      {% for pos in vals.for_print %}
          {% if pos == 1 %}
              <td bgcolor='green' align='center'>C</td>
          {% else %}
              <td></td>
          {% endif %}
      {% endfor %}
      </tr>
  {% endfor %}
  </table>

  <br>
  ICL3 NON FUSION PROTEINS CUTS
  <table width="1800" border=1>
  <tr><th colspan=3>Classification</th><th>GPCR</th>
  <th colspan={{truncations_new_possibilties.icl3_start|length}}>ICL3 Start</th>
  <th> Length </th>
  <th> No Aas </th>
  <th colspan={{truncations_new_possibilties.icl3_end|length}}>ICL3 End</th>
  </tr>
  <tr><th width=120>Class</th><th>Lig</th><th>Rec</th><th>Entry name</th>
  {% for pos in truncations_new_possibilties.icl3_start %}
  <th width=25 style="text-align: center;">{{pos}}</th>
  {% endfor %}
  <th> 5x50-6x50 </th>
  <th> Deleted </th>
  {% for pos in truncations_new_possibilties.icl3_end %}
  <th width=25 style="text-align: center;">{{pos}}</th>
  {% endfor %}
  </tr>
  {% for class, values in track_without_fusions.items %}
      {% for recp, vals in values.items %}
          <tr><td>{{class}}</td><td></td><td></td><td>{{recp}}</td>
          {% for pos in vals.for_print %}
              {% if pos == 'C' %}
                  <td bgcolor='green' align='center'>C</td>
              {% elif pos > 0 %}
                  <td bgcolor='red' align='center'>{{pos}}</td>
              {% else %}
                  <td></td>
              {% endif %}
          {% endfor %}
          </tr>
      {% endfor %}
  {% endfor %}
  </table>


  <br>
  N-TERM (non fused)
  <table width="100%">
  {% for class, values in truncations.nterm.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  N-TERM (fused)
  <table width="100%">
  {% for class, values in truncations.nterm_fusion.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  C-TERM
  <table width="100%">
  {% for class, values in truncations.cterm.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>


  <br>
  ICL3 (non fused)
  <table width="100%">
  {% for class, values in truncations.icl3.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>


  <br>
  ICL3 (fused)
  <table width="100%">
  {% for class, values in truncations.icl3_fusion.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  ICL2 (fused)
  <table width="100%">
  {% for class, values in truncations.icl2_fusion.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for position, proteins in values.items %}
  <tr><td>{{position}}</td><td>{{proteins|length}}</td><td>{{proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  MUTATION HOTSPOTS
  <table width="100%">
  {% for class, vals in mutation_list.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for gn, values in vals.items %}
  <tr><td>{{gn}}</td><td>{{values.hits}}</td><td>{{values.proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  MUTATION TYPES
  <table width="100%">
  {% for class, vals in mutation_type.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for gn, values in vals.items %}
  <tr><td>{{gn}}</td><td>{{values.hits}}</td><td>{{values.proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>

  <br>
  MUTATION TYPES (only WT aa)
  <table width="100%">
  {% for class, vals in mutation_wt.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for gn, values in vals.items %}
  <tr><td>{{gn}}</td><td>{{values.hits}}</td><td>{{values.proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>


  <br>
  MUTATION TYPES (only mutated aa)
  <table width="100%">
  {% for class, vals in mutation_mut.items %}
  <tr><td colspan="2">{{class}}</td></tr>
  {% for gn, values in vals.items %}
  <tr><td>{{gn}}</td><td>{{values.hits}}</td><td>{{values.proteins|join:", "}}</td></tr>
  {% endfor %}
  {% endfor %}
  </table>
</div>
{% endblock %}