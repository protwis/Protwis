{% extends "home/base.html" %}
{% load static %}

{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/button_spinner.css' %}" type="text/css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
{% endblock %}


{% block content %}

  <div class="row">
    <!-- description column -->
    <div class="col-md-8">
        <!-- main description -->
        <div class="col-md-12 panel panel-primary">
            <div class="panel-body">
                <h4>{{ title }}</h4>
                {{ description|linebreaks }}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <!-- button(s) -->

    </div>
  </div>
<div class="row">
    <div class="col-md-8">
      <!-- target search -->
      {% if search %}
          <div class="col-md-12 panel panel-primary">
              <div class="panel-body">
                  <h4>SMILES search</h4>
                  <div>
                      <form>
                      <div class="form-group">
                        <label for="ligand_structural_search_smiles">SMILES:<label>
                        <input id="ligand_structural_search_smiles" class="form-control" size="30" maxlength="200" value="{{ ligand_structural_search_parameters.smiles }}">
                        <select id="ligand_structural_search_search_type" class="form-select">
                            <option {% if ligand_structural_search_parameters.search_type == 'similarity' %}selected {% endif %}value="similarity">Search by similarity</option>
                            <option {% if ligand_structural_search_parameters.search_type == 'substructure' %}selected {% endif %}value="substructure">Search substructure</option>
                          </select>
                      </div>
                      <div style="{% if ligand_structural_search_parameters.search_type != 'similarity' %}display:none;{% endif %}height:44px" id="ligand_structural_search_similarity_div" class="form-group">
                        <label for="ligand_structural_search_similarity_threshold">Similarity threshold <span class="glyphicon glyphicon-info-sign" data-html="true" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content="<b>Similarity threshold</b><br>Minimum Tanimoto similarity coefficient between the Morgan-2 fingerprints of the query molecule and the ones in GPCRdb. Only values between 0.5 and 1 are allowed." data-original-title="" title=""></span>:<label>
                        <input style="width:75px" id="ligand_structural_search_similarity_threshold" class="form-control" maxlength="4" size="4" value="{{ ligand_structural_search_parameters.similarity_threshold }}">
                      </div>
                      <div style="{% if ligand_structural_search_parameters.search_type != 'substructure' %}display:none;{% endif %}height:44px" id="ligand_structural_search_stereo_div" class="form-group">
                          <input type="checkbox" {% if ligand_structural_search_parameters.stereochemistry %}checked {% endif %}id="ligand_structural_search_stereochemistry" value="True">
                        <label for="ligand_structural_search_stereochemistry">Stereochemistry<label><span class="glyphicon glyphicon-info-sign" data-html="true" data-toggle="popover" data-trigger="hover" data-placement="bottom" data-content="<b>Stereochemistry</b><br>Toggles whether or not stereochemistry is used in substructure matching. If checked, stereochemistry is taken into account." data-original-title="" title="">
                      </div>
                      {% comment %} 
                      <div class="form-group">
                        <label for="ligand_structural_search_limit">Limit:<label>
                        <input type="number" style="width:75px" id="ligand_structural_search_limit" class="form-control" maxlength="3" size="3" min="1" max="100" value="{{ ligand_structural_search_parameters.limit }}">
                      </div> 
                      {% endcomment %}
                      <div class="form-group">
                      <p style="{% if ligand_structural_search_error_msg != 'No results found.'%}color: red; {% endif %}">{{ ligand_structural_search_error_msg }}</p>
                      </div>
                      </form>
                    </div>
                  <div id="selection-buttons">
                    {% include 'common/selection_buttons.html' %}
                  </div>
              </div>
          </div>
      {% endif %}
    </div>
  </div>
  {% if buttons.continue.label %}

  {% endif %}
{% endblock %}

{% block addon_js %}
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script type="text/javascript">
        var type_of_selection = '{{ type_of_selection }}';
        var selection_only_receptors = '{{ selection_only_receptors }}';
        var redirect_url = '{{ buttons.continue.url }}'
        var redirect_on_select = '{{ redirect_on_select }}'
    </script>
    {% comment %} <script src="{% static 'home/js/selection-autocomplete.js' %}"></script> {% endcomment %}
    <script src="{% static 'home/js/selection-filters.js' %}"></script>
    <script src="{% static 'home/js/selection.js' %}"></script>

    <script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script>
    <script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
    <script src="{% static 'home/js/select2.js' %}"> </script>

    <!-- Target select modal table -->
    <script type="text/javascript" src="{% static 'home/js/targetselect_functions.js' %}"> </script>

    <script type="text/javascript" src="{% static 'home/js/ligand_structural_search.js' %}"> </script>

    <script>
        const csrf_token = "{{ csrf_token }}";

  


        {% if filter_tableselect %}
        $(document).ready(function() {
            // Get Receptor Targets for table build
            initializeTargetChooserTables();

            $('#targetselect-modal-table').on('shown.bs.modal', function (e) {
                showTARGETtable('#targetselect-modal-table');
            })


            $('#targetselect-modal-table').on('hidden.bs.modal', AddMultipleTargets);

        });
        {% endif %}
        $(document).ready(function() {
          $('[data-toggle="popover"]').popover();
            $('#ligand_structural_search_search_type').on('change',function (e) {
              if (this.value === 'similarity') {
                    
                    $('#ligand_structural_search_stereo_div').hide();
                    $('#ligand_structural_search_similarity_div').show();
                } else if (this.value === 'substructure') {
                    $('#ligand_structural_search_stereo_div').show();
                    $('#ligand_structural_search_similarity_div').hide();
                }
                  
            });
        });

    </script>
{% endblock %}
