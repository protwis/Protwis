{% extends "home/base.html" %}
{% load static %}
{% load structure_extras %}
{% load ligand_extras %}

{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/bootstrap2-toggle.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/modal.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css" />
<style>
    /*Assay description tooltip*/
    .AssayCell {
        position: relative;
    }

    .AssayDetail {
        display: none;
        position: absolute;
        z-index: 100;
        border: 1px;
        background-color: black;
        border-style: solid;
        border-width: 1px;
        padding: 3px;
        color: white;
        top: 20px;
        left: 20px;
        width: 250px;
        white-space: pre-wrap;
    }

    .AssayCell:hover span.AssayDetail {
        display: block;
    }
    /*Structure preview in tooltip*/
    pre {
        display: block;
        font: 100% "Courier New", Courier, monospace;
        padding: 10px;
        border: 1px solid #bae2f0;
        background: #e3f4f9;
        margin: .5em 0;
        overflow: auto;
        width: 800px;
    }

    #struct {
        display: none;
        position: absolute;
        z-index: 100;
        border: 1px;
        background-color: white;
        border-style: solid;
        border-width: 1px;
        padding: 3px;
    }
    .scroll-container {
        /*max-width: 200px;*/
        overflow-x: scroll;
        overflow-y: auto;
    }
    .yadcf-filter-wrapper {
      position: center;
      display: flex;
      white-space: nowrap;
      margin-top: 7px;
      width: 50% !important;
    }
    .yadcf-filter-wrapper-inner {
      display: block !important;
    }
</style>

<style type="text/css">
	.dataTables_scrollHeadInner {
		margin-top: 20px;
	}


  .select2-container {
    max-width: 50px !important;
  }


	table.dataTable thead th,
	table.dataTable tbody td {
		max-width: 50px;
		word-break: break-all;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	table.dataTable thead .sorting {
		background-position: right;
	}

	.select2-container select2-container-multi {
		width: 75%;
	}

	.select2-container-multi .select2-choices .select2-search-field input {
		max-width: 50px;
	}

	.yadcf-filter-wrapper {
		position: center;
		display: flex;
		white-space: nowrap;
		margin-top: 7px;
		width: 50%;
	}

	.yadcf-filter-wrapper-inner {
		white-space: normal;
		display: flex;
		flex-direction: row;
		justify-content: center;
	}

	.select2-results {
		background-color: white;
		border: gray;
		width: 150px !important;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 30px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		margin-bottom: 5%;
		min-width: 30px;
	}

/*Uncomment to remove arrows*/
/*  .select-page-th.sorting {
		background-image: none !important;
	}

	.select-page-th.sorting_desc {
		background-image: none !important;
	}

	.select-page-th.sorting_asc {
		background-image: none !important;
	}

	table.dataTable thead .sorting {
		background-image: none !important;
	}

	table.dataTable thead .sorting_desc {
		background-image: none !important;
	}

	table.dataTable thead .sorting_asc {
		background-image: none !important;
	}
*/

  table.dataTable.compact tbody th,
	table.dataTable.compact tbody td {
		padding: 5px 10px 5px 0px !important;
		/* width: 0px; */
	}

	table.dataTable.compact thead th,
	table.dataTable.compact thead td {
		padding: 5px 10px 5px 0px;
		/* width: 0px; */
	}

	table.dataTable.compact thead tr.over_header th {
		border-bottom: 1px solid #ccc;
	}

	table.dataTable.compact thead th.leftborder {
		border-left: 1px solid;
	}

	table.dataTable.compact thead th.rightborder {
		border-right: 1px solid;
	}

	.clicked_button {
		background-color: rgb(215, 215, 215);
	}

	#overlay {
		top: 0px;
		position: absolute;
		background: #f8f8f8;
		/*border: 1px solid #333;*/
		-webkit-box-shadow: 5px 0 2px -2px #888;
		box-shadow: 5px 0 2px -2px #888;
	}

	.wrapper {
		overflow-x: scroll;
		overflow-y: hidden;
	}

	#overlay tbody tr {
		background-color: #f8f8f8;
	}

	#count_row th {
		font-size: 11px;
		text-align: center;
	}

	.switch-field label:hover {
		cursor: pointer;
		/* width: 100%; */
	}

	.switch-field input:checked+label {
		background-color: #337ab7;
		/* #a5dc86; */
		box-shadow: none;
	}

	.border-left {
		padding-left: 3px;
	}

	.switch-field label:first-of-type {
		border-radius: 4px 0 0 4px;

	}

	.switch-field label:last-of-type {
		border-radius: 0 4px 4px 0;
	}

	.name {
		width: 100px;
		text-overflow: ellipsis;
		cursor: pointer;
		word-break: break-all;
		overflow: hidden;
		white-space: nowrap;
	}

	.name:hover {
		overflow: visible;
		white-space: normal;

	}

	.toolbar_data_css {
		width: 250px;
		margin-right: auto;
		margin-left: 0px;
		/* border: 1px solid; */
		font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		font-weight: normal;
		font-size: 120%;
		line-height: 1.625;
	}

	.toolbar_data_css.td {
		height: 15px;
		max-width: 150px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
</style>
{% endblock %}

{% block addon_js %}
<script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script>
<script src="{% static 'home/js/dataTables.tableTools.min.js' %}"> </script>
<script src="{% static 'home/js/jquery.dataTables.columnFilter.js' %}"> </script>
<script src="{% static 'home/js/selection.js' %}"> </script>
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
<script src="{% static 'home/js/select2.js' %}"> </script>
<script src="{% static 'home/js/gpcrdb.js' %}"></script>
<script src="{% static 'home/js/alphaSortCaseInsensitive.js' %}"></script>

<!--<script src="https://cdn.datatables.net/plug-ins/2.1.5/sorting/natural.js"></script>--><!-- Requires update to DataTables2+ -->

<script type="text/javascript" charset="utf-8">
    var target_details_affinity_pages = {};
    var target_details_potency_pages = {};
    var target_details_iDisplayLength_potency = 50;
    var target_details_iDisplayLength_affinity = 50;

    var key_0_affinity = '0_'+target_details_iDisplayLength_affinity;  
    target_details_affinity_pages[key_0_affinity] = true;
    var key_0_potency = '0_'+target_details_iDisplayLength_potency; 
    target_details_potency_pages[key_0_potency] = true;

    this.compoundPreview = function (selection="a.struct") {

        //Define position of the tooltip in relation to the cursor
        xOffset = 30;
        yOffset = -10;

        $(selection).hover(function (e) {
            this.t = this.title;
            this.title = "";
            var c = (this.t != "") ? "<br/>" + this.t : "";
            $("body").append("<p id='struct'><img style='max-width: 200px; height: auto' src='" + this.rel + "'/>" + c + "</p>");
            $("#struct")
                .css("top", (e.pageY - yOffset) + "px")
                .css("left", (e.pageX + xOffset) + "px")
                .fadeIn("fast");
        },
            function () {
                this.title = this.t;
                $("#struct").remove();
            });
        $(selection).mousemove(function (e) {
            $("#struct")
                .css("top", (e.pageY - yOffset) + "px")
                .css("left", (e.pageX + xOffset) + "px");
        });
    };
    var mode = '{{ mode }}';
    var ligand_query = '{{ ligand_query }}';
    console.log(mode);
    var target_details_table_potency;
    var target_details_table_affinity ;
    $(document).ready(function () {
        var columnDefs = [

        ];
        //Requires update to DataTables2+ for natural sorting
        /*var columnDefs = [
          { type: 'natural-ci', target: 1 },
          
        ];
        if(mode == 'extended'){
          columnDefs.push({ type: 'natural-ci', target: 13 });
        } elif (!ligand_query) {
          columnDefs.push({ type: 'natural-ci', target: 13 });
        } else {

        }*/
        var iDisplayLength_potency = target_details_iDisplayLength_potency;
        var iDisplayLength_affinity = target_details_iDisplayLength_affinity;

        var table_potency = $('#proteins_potency').DataTable({
            columnDefs: columnDefs,
            scrollX: true,
            scrollY: $(window).height() - 100,
            bScrollCollapse: true,
            paging: true,
            paging_type: 'full_numbers',
            iDisplayLength: iDisplayLength_potency,
            orderCellsTop: true,
            autoWidth: true,
            drawCallback: function (settings) {
              if (typeof target_details_table_potency === 'undefined') {
                return;
              }
              var page = target_details_table_potency.page.info().page;
              var page_length = target_details_table_potency.page.info().length;
              if (typeof page === 'undefined' || typeof page_length === 'undefined') {
                return;
              }
              var key = page+'_'+page_length;
              if (!target_details_potency_pages.hasOwnProperty(key)) {
                compoundPreview("a.struct_potency");
                target_details_potency_pages[key] = true;
              }
            },
        });

        var table_affinity = $('#proteins_affinity').DataTable({
            columnDefs: columnDefs,
            scrollX: true,
            scrollY: $(window).height() - 100,
            bScrollCollapse: true,
            paging: true,
            paging_type: 'full_numbers',
            iDisplayLength: iDisplayLength_affinity,
            orderCellsTop: true,
            autoWidth: true,
            drawCallback: function (settings) {
              if (typeof target_details_table_affinity === 'undefined') {
                return;
              }
              var page = target_details_table_affinity.page.info().page;
              var page_length = target_details_table_affinity.page.info().length;
              if (typeof page === 'undefined' || typeof page_length === 'undefined') {
                return;
              }
              var key = page+'_'+page_length;
              if (!target_details_affinity_pages.hasOwnProperty(key)) {
                compoundPreview("a.struct_affinity");
                target_details_affinity_pages[key] = true;
              }
            }
        });

        target_details_table_potency = table_potency;
        target_details_table_affinity = table_affinity;

        var target_details_affinity_current_page = 1;
        let column_filters = [];
        var other_YADCF_filters_num = {sort_as: 'num'};
        var other_YADCF_filters_text = {sort_as: 'custom', case_insensitive: true, sort_as_custom_func: alphaSortCaseInsensitive};
        var other_YADCF_filters_smiles = {sort_as: 'alpha', case_insensitive: false};
        if(mode == 'extended'){
          var smiles_column = 20;
          column_filters = column_filters.concat(createYADCFfilters(1, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_text));
          column_filters = column_filters.concat(createYADCFfilters(2, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_num));
          column_filters = column_filters.concat(createYADCFfilters(3, 1, "range_number", null, ["Min", "Max"], false, null, null, "30px"));
          column_filters = column_filters.concat(createYADCFfilters(4, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
          column_filters = column_filters.concat(createYADCFfilters(5, 2, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
          column_filters = column_filters.concat(createYADCFfilters(7, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
          column_filters = column_filters.concat(createYADCFfilters(8, 1, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
          column_filters = column_filters.concat(createYADCFfilters(9, 6, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
          column_filters = column_filters.concat(createYADCFfilters(15, 5, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
          column_filters = column_filters.concat(createYADCFfilters(20, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_smiles));
          column_filters = column_filters.concat(createYADCFfilters(21, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
        }else{
          if(!ligand_query){
            var smiles_column = 21;
            column_filters = column_filters.concat(createYADCFfilters(1, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(2, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_num));
            column_filters = column_filters.concat(createYADCFfilters(3, 2, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(5, 2, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
            column_filters = column_filters.concat(createYADCFfilters(7, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(8, 7, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
            column_filters = column_filters.concat(createYADCFfilters(9, 1, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(10, 4, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
            column_filters = column_filters.concat(createYADCFfilters(14, 2, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(16, 5, "range_number", null, ["Min", "Max"], false, null, null, "30px"))
            column_filters = column_filters.concat(createYADCFfilters(21, 1, "multi_select", "select2", "Select", false, "exact", "text", "50px", null, null, null, other_YADCF_filters_smiles));
            }else{
            var smiles_column = 25;            
            column_filters = column_filters.concat(createYADCFfilters(1, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(2, 1, "multi_select", "select2", "Select", false, "exact", "html", "80px", null, null, null, other_YADCF_filters_num));
            column_filters = column_filters.concat(createYADCFfilters(3, 2, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(5, 2, "range_number", null, ["Min", "Max"], false, null, null, "30px"));
            column_filters = column_filters.concat(createYADCFfilters(7, 5, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(12, 1, "range_number", null, ["Min", "Max"], false, null, null, "30px"));
            column_filters = column_filters.concat(createYADCFfilters(13, 1, "multi_select", "select2", "Select", false, "exact",  "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(14, 4, "range_number", null, ["Min", "Max"], false, null, null, "30px"));
            column_filters = column_filters.concat(createYADCFfilters(18, 2, "multi_select", "select2", "Select", false, "exact", "rendered_html", "50px", null, null, null, other_YADCF_filters_text));
            column_filters = column_filters.concat(createYADCFfilters(20, 5, "range_number", null, ["Min", "Max"], false, null, null, "30px"));
            column_filters = column_filters.concat(createYADCFfilters(25, 1, "multi_select", "select2", "Select", false, "exact", "text", "50px", null, null, null, other_YADCF_filters_smiles));
          }
        }

        yadcf.init(table_potency.draw(), column_filters, {
          cumulative_filtering: false
        });

        yadcf.init(table_affinity.draw(), column_filters, {
          cumulative_filtering: false
        });

        $('.alt').change(function () {
            $(this).parent().parent().toggleClass('alt_selected');
        });
        $('.select-page').change(function () {
            $('.alt').prop('checked', $(this).prop("checked"));
            $('.alt').parent().parent().toggleClass('alt_selected');
        });
        //
        const btn_pot = document.getElementById("selectall_potency");
        const btn_aff = document.getElementById("selectall_affinity");

        btn_pot.addEventListener("click", ()=>{
            if(btn_pot.innerText === "Select full table"){
                btn_pot.innerText = "Deselect full table";
            }else{
                btn_pot.innerText= "Select full table";
            }
        });

        btn_aff.addEventListener("click", ()=>{
            if(btn_aff.innerText === "Select full table"){
                btn_aff.innerText = "Deselect full table";
            }else{
                btn_aff.innerText= "Select full table";
            }
        });

        $("#selectall_potency").click(function() {
            var rows = table_potency.rows().nodes();
            if($('input:checked', rows).length == rows.length){
               $('input[type="checkbox"]', rows).prop('checked', false);
               table_potency.rows().every(function() {
                 this.nodes().to$().removeClass('alt_selected')
               })
            }
            else{
               $('input[type="checkbox"]', rows).prop('checked', true);
               table_potency.rows().every(function() {
                 this.nodes().to$().addClass('alt_selected')
               })
            }
        });
        $("#selectall_affinity").click(function() {
            var rows = table_affinity.rows().nodes();
            if($('input:checked', rows).length == rows.length){
               $('input[type="checkbox"]', rows).prop('checked', false);
               table_affinity.rows().every(function() {
                 this.nodes().to$().removeClass('alt_selected')
               })
            }
            else{
               $('input[type="checkbox"]', rows).prop('checked', true);
               table_affinity.rows().every(function() {
                 this.nodes().to$().addClass('alt_selected')
               })
            }
        });

        $("#potency").find(".hide_columns").click(function(evt) {
          var columns = $(this).attr("columns").split(",");
          columns.forEach(function(column) {
              var column = table_potency.column( column );
              try {
                  column.visible( false, false );
              }
              catch(err) {
                  column.visible( false, false );
              }
              });
              table_potency.draw();
        } );
        $("#affinity").find(".hide_columns").click(function(evt) {
          var columns = $(this).attr("columns").split(",");
          columns.forEach(function(column) {

              var column_affinity = table_affinity.column( column );
              try {
                  column_affinity.visible( false, false );
              }
              catch(err) {
                  column_affinity.visible( false, false );
              }
              });
              table_affinity.draw();
        } );

        $("#reset_hidden_potency").click(function(evt) {
          let potency_length = table_potency.columns()[0].length;
          let potency_columns = Array.from(new Array(potency_length - 1), (x, i) => i);
          table_potency.columns(potency_columns).visible(true, false);
          table_potency.draw();
        } );
        $("#reset_hidden_affinity").click(function(evt) {
          let affinity_length = table_affinity.columns()[0].length;
          let affinity_columns = Array.from(new Array(affinity_length - 1), (x, i) => i);
          table_affinity.columns(affinity_columns).visible(true, false);
          table_affinity.draw();
        } );    
        
        $('#csv_btn_potency').click(function () {
            // TODO: redactor in a single fucntion shared by csv_btn_potency and csv_btn_potency affinity
            var checked_data = table_potency.rows('.alt_selected').data();
            var checked_data = table_potency.rows('.alt_selected').data();
            var csv_data = [];

            {% if mode == 'extended' %}
              csv_data.push('Lig. Name;GPCRdb ID;#Vendors;Ref. Ligand;Fold selectivity (Potency);# Tested GPCRs;Species;p-value (-log);Value type;Activ. relation;Activ. value;Assay type;Assay descript.;Source; Mol. weight;Rot. Bonds;H don;H acc;LogP;Smiles;DOI')
            {% endif %}
            {% if mode == 'compact' %}
              csv_data.push('Lig. Name;GPCRdb ID;Lig. type;Ref. Ligand;Fold selectivity (Potency);# Tested GPCRs;{% if ligand_query %}Receptor (Gtp);Receptor (UniProt);{% endif %}Species;{% if ligand_query %}Class;Family;{% endif %}#Vendors;Assay type;#Records;Min.;Average;Max.;Activ. Value;Source;Mol. weight;Rot. Bonds;H don;H acc;LogP;Smiles')
            {% endif %}
            for (i = 0; i < checked_data.length; i++) {
                var csv_row = []
                for (j = 1; j < checked_data[i].length; j++) {
                    var div = document.createElement("div");
                    div.innerHTML = checked_data[i][j];
                    if (typeof div.innerText !== "undefined") {
                      csv_row.push(div.innerText.trim());
                    } else {
                      csv_row.push(div.textContent.trim());
                    }
                }
                csv_data.push(csv_row.join(';'));
            }
            var csv_string = csv_data.join("\n");
            if (window.navigator.msSaveOrOpenBlob) {
                var blob = new Blob([csv_string]);
                window.navigator.msSaveOrOpenBlob(blob, 'target_ligand_potency_data.csv');
            } else {
                var a = document.createElement('a');
                a.href = 'data:attachment/csv,' + encodeURIComponent(csv_string);
                a.target = '_blank';
                a.download = 'target_ligand_data.csv';
                document.body.appendChild(a);
                a.click();
            }
        });
        $('#csv_btn_affinity').click(function () {
            var checked_data = table_affinity.rows('.alt_selected').data();
            var checked_data = table_affinity.rows('.alt_selected').data();
            var csv_data = [];
           
            {% if mode == 'extended' %}
              csv_data.push('Lig. Name;GPCRdb ID;#Vendors;Ref. Ligand;Fold selectivity (Affinity);# Tested GPCRs;Species;p-value (-log);Value type;Activ. relation;Activ. value;Assay type;Assay descript.;Source; Mol. weight;Rot. Bonds;H don;H acc;LogP;Smiles;DOI')
            {% endif %}
            {% if mode == 'compact' %}
              csv_data.push('Lig. Name;GPCRdb ID;Lig. type;Ref. Ligand;Fold selectivity (Affinity);# Tested GPCRs;{% if ligand_query %}Receptor (Gtp);Receptor (UniProt);{% endif %}Species;{% if ligand_query %}Class;Family;{% endif %}#Vendors;Assay type;#Records;Min.;Average;Max.;Activ. Value;Source;Mol. weight;Rot. Bonds;H don;H acc;LogP;Smiles')
            {% endif %}
            
            for (i = 0; i < checked_data.length; i++) {
                var csv_row = []
                for (j = 1; j < checked_data[i].length; j++) {
                    var div = document.createElement("div");
                    div.innerHTML = checked_data[i][j];
                    if (typeof div.innerText !== "undefined") {
                      csv_row.push(div.innerText.trim());
                    } else {
                      csv_row.push(div.textContent.trim());
                    }
                }
                csv_data.push(csv_row.join(';'));
            }
            var csv_string = csv_data.join("\n");
            if (window.navigator.msSaveOrOpenBlob) {
                var blob = new Blob([csv_string]);
                window.navigator.msSaveOrOpenBlob(blob, 'target_ligand_affinity_data.csv');
            } else {
                var a = document.createElement('a');
                a.href = 'data:attachment/csv,' + encodeURIComponent(csv_string);
                a.target = '_blank';
                a.download = 'target_ligand_data.csv';
                document.body.appendChild(a);
                a.click();
            }
        });

        $('#smi_btn_potency').click(function () {
            var checked_data = table_potency.rows('.alt_selected').data();
            let smi_data = [];
            let processed = [];
            for (i = 0; i < checked_data.length; i++) {
                var div = document.createElement("div");
                div.innerHTML = checked_data[i][1];
                name = div.textContent;
                if (!processed.includes(name)){
                  let smi_row = checked_data[i][smiles_column] + "\t" + name;
                  smi_data.push(smi_row);
                  processed.push(name);
                }
            }
            let smi_string = smi_data.join("\n");
            if (window.navigator.msSaveOrOpenBlob) {
                var blob = new Blob([smi_string]);
                window.navigator.msSaveOrOpenBlob(blob, 'target_ligands_potency.smi');
            } else {
                var a = document.createElement('a');
                a.href = 'data:attachment/smi,' + encodeURIComponent(smi_string);
                a.target = '_blank';
                a.download = 'target_ligands_potency.smi';
                document.body.appendChild(a);
                a.click();
            }
        });

        $('#smi_btn_affinity').click(function () {
            var checked_data = table_affinity.rows('.alt_selected').data();
            let smi_data = [];
            let processed = [];
            for (i = 0; i < checked_data.length; i++) {
                var div = document.createElement("div");
                div.innerHTML = checked_data[i][1];
                name = div.textContent;
                if (!processed.includes(name)){
                  let smi_row = checked_data[i][smiles_column] + "\t" + name;
                  smi_data.push(smi_row);
                  processed.push(name);
                }
            }
            let smi_string = smi_data.join("\n");
            if (window.navigator.msSaveOrOpenBlob) {
                var blob = new Blob([smi_string]);
                window.navigator.msSaveOrOpenBlob(blob, 'target_ligands_afffinity.smi');
            } else {
                var a = document.createElement('a');
                a.href = 'data:attachment/smi,' + encodeURIComponent(smi_string);
                a.target = '_blank';
                a.download = 'target_ligands_affinity.smi';
                document.body.appendChild(a);
                a.click();
            }
        });
        $('#purchasability-btn').click(function () {
            window.location.href = '/ligand/targets_purchasable';
        });
        compoundPreview();
        setTimeout(function () {
            table_potency.columns.adjust().draw();
            table_affinity.columns.adjust().draw();
        }, 10);
    })
</script>

{% endblock %}
{% block content %}

  {% if mode == 'extended' %}

  <h3>Ligand source activities (1 row/activity)</h3>

  <ul class="nav nav-tabs">
    <li class="nav-item active">
      <a class="nav-link" data-toggle="tab" href="#potency">Potency</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" data-toggle="tab" href="#affinity">Affinity</a>
    </li>
  </ul>
  <div class="tab-content">
    <div class="tab-pane container active" id="potency">
      <br />
      <br />
      {% if ligand_query %}
      <div class="btn-group">
        <a class="btn btn-primary" href="/ligand/ligand_by_name" style="margin-top:10px;margin-top:3px">New Search</a>
      </div>
      {% endif %}
      <div class="btn-group">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false" style="margin-top:10px;margin-top:3px">
              <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
              <li>
                  <a id="csv_btn_potency" href="javascript:void(0)">CSV</a>
              </li>
              <li>
                  <a id="smi_btn_potency" href="javascript:void(0)">SMILES</a>
              </li>
          </ul>
      </div>
      {% if not ligand_query %}
      <div class="btn-group">
          <a id="purchasability-btn" class="btn btn-primary" href="javascript:void(0)" style="margin-top:10px;margin-top:3px">Get vendors</a>
      </div>
      {% endif %}
      <div class="btn-group">
        <button id="reset_hidden_potency" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Reset columns</button>
      </div>
      <div class="btn-group">
        <button id="selectall_potency" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Select full table</button>
      </div>
      <br />
      <br />
      <div class="double_scroll" style="padding-top: 0px; font-size: 10px; white-space: nowrap;">
          <table style="width:100%" class="display" id="proteins_potency">
              <thead>
                  <tr class="header-spans">
                    <th style="text-align:left" colspan="5">Ligands (move mouse cursor over ligand name to see structure)
                      <button type="button" class="close hide_columns" columns="1,2,3,4" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </th>
                    <th style="border-left: 1px solid black; text-align:left" colspan="3" style="">Receptor
                      <button type="button" class="close hide_columns" columns="5,6,7" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </th>
                    <th style="border-left: 1px solid black; text-align:left" colspan="7">Assay information
                      <button type="button" class="close hide_columns" columns="8,9,10,11,12,13,14" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </th>
                    <th style="border-left: 1px solid black; text-align:left" colspan="7">Chemical information
                      <button type="button" class="close hide_columns" columns="15,16,17,18,19,20,21"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    </th>
                  </tr>
                  <tr>
                      <th class="select-page-th"><input class="select-page" type="checkbox">Sel. page</th>
                      <th style="text-align:left">Common<br />name</th>
                      <th style="text-align:left">GPCRdb<br />ID</th>
                      <th style="text-align:left">#Vendors<br /><br /></th>
                      <th style="text-align:left">Reference<br />ligand</th>

                      <th style="border-left: 1px solid black;text-align:left" class="general-th">Fold<br />selectivity</th>
                      <th style="text-align:left"># Tested<br />GPCRs</th>

                      <th style="text-align:left">Species<br /><br /></th>
                      <th style="border-left: 1px solid black;text-align:left" class="activity-th">p-value<br />(-log)</th>
                      <th style="text-align:left">Activity<br />Type</th>
                      <th style="text-align:left">Activity<br />Relation</th>
                      <th style="text-align:left">Activity<br />Value</th>
                      <th style="text-align:left">AssayType<br /><br /></th>
                      <th style="text-align:left">Assay<br>Description</th>
                      <th style="text-align:left">Source<br /><br /></th>
                      <th style="border-left: 1px solid black;text-align:left" class="chemical-th">Mol<br />weight</th>
                      <th style="text-align:left">Rot<br />Bonds</th>
                      <th style="text-align:left">H don<br /><br /></th>
                      <th style="text-align:left">H acc<br /><br /></th>
                      <th style="text-align:left">LogP<br /><br /></th>
                      <th style="text-align:left">Smiles<br /><br /></th>
                      <th style="text-align:left">DOI<br /><br /></th>
                  </tr>
              </thead>
              <tbody>
                  {% for p in potency_data %}
                  <tr>
                      <td><input class="alt" type="checkbox"></td>
                      <td><a class="struct" rel="http://www.ebi.ac.uk/chembl/api/data/image/{{p.ligand__ids__index}}" href="/ligand/{{p.ligand__id}}/info" target="_blank">{{p.ligand__ids__index}}</a></td>
                      <td align="right"><a href="/ligand/{{p.ligand__id}}/info" target="_blank">{{p.ligand__id}}</a></td>
                      <td align="right">{{p.purchasability}}</td>
                      <td>{{p.reference_ligand}}</td>

                      <td align="right">{{p.potency}}</td>
                      <td align="right">{{p.count_potency_test}}</td>

                      <td>{{p.protein__species__common_name}}</td>
                      <td align="right">{{p.p_activity_value|floatformat:1}}</td>
                      <td align="center">{% if p.source == 'ChEMBL' %} p{{p.value_type}} {% else %} {{p.value_type}} {% endif %}</td>
                      <td>{{p.standard_relation}}</td>
                      <td align="right">{{p.p_activity_value|floatformat}}</td>
                      <td>{% if p.assay_type == 'B' %} Binding {% elif p.assay_type == 'F' %} Functional {% elif p.assay_type == 'U' %} Unclassified {% elif p.assay_type == 'A' %} ADMET {% endif %}</td>
                      <td class="AssayCell"> <div style="overflow: hidden; text-overflow: ellipsis; word-wrap: break-word; max-width: 350px;white-space: nowrap;">{{p.assay_description}}<span class="AssayDetail">{{p.assay_description}}</span> </div></td>
                      <td>{{p.source}}</td>
                      <td align="right">{{p.ligand__mw|floatformat:0}}</td>
                      <td align="right">{{p.ligand__rotatable_bonds}}</td>
                      <td align="right">{{p.ligand__hdon}}</td>
                      <td align="right">{{p.ligand__hacc}}</td>
                      <td align="right">{{p.ligand__logp|floatformat:1}}</td>
                      <td class="dt-left">{{p.ligand__smiles}}</td>
                      <td><a href="{{p.link}}" target="_blank">{{p.publication__web_link__index}}</a></td>
                  </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
    </div>
    <div class="tab-pane container" id="affinity">
      <br />
      <br />
      {% if ligand_query %}
      <div class="btn-group">
        <a class="btn btn-primary" href="/ligand/ligand_by_name" style="margin-top:10px;margin-top:3px">New Search</a>
      </div>
      {% endif %}
      <div class="btn-group">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false" style="margin-top:10px;margin-top:3px">
              <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
              <li>
                  <a id="csv_btn_affinity" href="javascript:void(0)">CSV</a>
              </li>
              <li>
                  <a id="smi_btn_affinity" href="javascript:void(0)">SMILES</a>
              </li>
          </ul>
      </div>
      {% if not ligand_query %}
      <div class="btn-group">
          <a id="purchasability-btn" class="btn btn-primary" href="javascript:void(0)" style="margin-top:10px;margin-top:3px">Get vendors</a>
      </div>
      {% endif %}
      <div class="btn-group">
        <button id="reset_hidden_affinity" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Reset columns</button>
      </div>
      <div class="btn-group">
        <button id="selectall_affinity" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Select full table</button>
      </div>
      <br />
      <br />
      <div style="padding-top: 0px; font-size: 10px; white-space: nowrap;" class="scroll-container double_scroll">
        <table style="width:100%" class="display" id="proteins_affinity">
            <thead>
                <tr class="header-spans">
                  <th style="text-align:left" colspan="5">Ligands (move mouse cursor over ligand name to see structure)
                    <button type="button" class="close hide_columns" columns="1,2,3,4" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                  <th style="border-left: 1px solid black; text-align:left" colspan="{% if ligand_query %}7{% else %}3{% endif %}" style="">Receptor
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}5,6,7,8,9,10,11{% else %}5,6,7{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                  <th style="border-left: 1px solid black; text-align:left" colspan="7">Assay information
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}12,13,14,15,16,17,18{% else %}8,9,10,11,12,13,14{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                  <th style="border-left: 1px solid black; text-align:left" colspan="7">Chemical information
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}19,20,21,22,23,24,25{% else %}15,16,17,18,19,20,21{% endif %}"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                </tr>
                <tr>
                    <th class="select-page-th"><input class="select-page" type="checkbox">Sel. page</th>
                    <th style="text-align:left">Common<br >name</th>
                    <th style="text-align:left">GPCRdb<br />ID</th>
                    <th style="text-align:left">#Vendors<br /><br /></th>
                    <th style="text-align:left">Reference<br />ligand</th>

                    <th style="border-left: 1px solid black;text-align:left" class="general-th">Fold<br />selectivity</th>
                    <th style="text-align:left"># Tested<br />GPCRs</th>

                    <th style="text-align:left">Species<br /><br /></th>
                    <th style="border-left: 1px solid black;text-align:left" class="activity-th">p-value<br />(-log)</th>
                    <th style="text-align:left">Activity<br />Type</th>
                    <th style="text-align:left">Activity<br />Relation</th>
                    <th style="text-align:left">Activity<br />Value</th>
                    <th style="text-align:left">Assay<br>Type</th>
                    <th style="text-align:left">Assay<br />Description</th>
                    <th style="text-align:left">Source<br /><br /></th>
                    <th style="border-left: 1px solid black;text-align:left" class="chemical-th">Mol<br />weight</th>
                    <th style="text-align:left">Rot<br />Bonds</th>
                    <th style="text-align:left">H don<br /><br /></th>
                    <th style="text-align:left">H acc<br /><br /></th>
                    <th style="text-align:left">LogP<br /><br /></th>
                    <th style="text-align:left">Smiles<br /><br /></th>
                    <th style="text-align:left">DOI<br /><br /></th>
                </tr>
            </thead>
            <tbody>
                {% for p in affinity_data %}
                <tr>
                    <td><input class="alt" type="checkbox"></td>
                    <td><a class="struct" rel="http://www.ebi.ac.uk/chembl/api/data/image/{{p.ligand__ids__index}}" href="/ligand/{{p.ligand__id}}/info" target="_blank">{{p.ligand__ids__index}}</a></td>
                    <td align="right"><a href="/ligand/{{p.ligand__id}}/info" target="_blank">{{p.ligand__id}}</a></td>
                    <td align="right">{{p.purchasability}}</td>
                    <td>{{p.reference_ligand}}</td>

                    <td align="right">{{p.affinity}}</td>
                    <td align="right">{{p.count_affinity_test}}</td>

                    <td>{{p.protein__species__common_name}}</td>
                    <td align="right">{{p.p_activity_value|floatformat:1}}</td>
                    <td align="center">{% if p.source == 'ChEMBL' %} p{{p.value_type}} {% else %} {{p.value_type}} {% endif %}</td>
                    <td>{{p.standard_relation}}</td>
                    <td align="right">{{p.p_activity_value|floatformat}}</td>
                    <td>{% if p.assay_type == 'B' %} Binding {% elif p.assay_type == 'F' %} Functional {% elif p.assay_type == 'U' %} Unclassified {% elif p.assay_type == 'A' %} ADMET {% endif %}</td>
                    <td class="AssayCell"> <div style="overflow: hidden; text-overflow: ellipsis; word-wrap: break-word; max-width: 350px;white-space: nowrap;">{{p.assay_description}}<span class="AssayDetail">{{p.assay_description}}</span> </div></td>
                    <td>{{p.source}}</td>
                    <td align="right">{{p.ligand__mw|floatformat:0}}</td>
                    <td align="right">{{p.ligand__rotatable_bonds}}</td>
                    <td align="right">{{p.ligand__hdon}}</td>
                    <td align="right">{{p.ligand__hacc}}</td>
                    <td align="right">{{p.ligand__logp|floatformat:1}}</td>
                    <td class="dt-left">{{p.ligand__smiles}}</td>
                    <td><a href="{{p.link}}" target="_blank">{{p.publication__web_link__index}}</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
      </div>
    </div>
  </div>
 {% else %}
   <br />
   {% if ligand_query %}
      <h3>Ligand min, max & mean activities (1 row/ligand-target)</h3>
   {% else %}
      <h3>Ligand min, max & mean activities (1 row/ligand)</h3>
   {% endif %}
   <ul class="nav nav-tabs">
     <li class="nav-item active">
       <a class="nav-link" data-toggle="tab" href="#potency">Potency</a>
     </li>
     <li class="nav-item">
       <a class="nav-link" data-toggle="tab" href="#affinity">Affinity</a>
     </li>
   </ul>
   <div class="tab-content">
     <div class="tab-pane container active" id="potency">
       <br />
       <br />
       {% if ligand_query %}
       <div class="btn-group">
         <a class="btn btn-primary" href="/ligand/ligand_by_name" style="margin-top:10px;margin-top:3px">New Search</a>
       </div>
       {% endif %}
       <div class="btn-group">
           <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                   aria-haspopup="true" aria-expanded="false" style="margin-top:10px;margin-top:3px">
               <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
           </button>
           <ul class="dropdown-menu">
               <li>
                   <a id="csv_btn_potency" href="javascript:void(0)">CSV</a>
               </li>
               <li>
                   <a id="smi_btn_potency" href="javascript:void(0)">SMILES</a>
               </li>
           </ul>
       </div>
       {% if not ligand_query %}
       <div class="btn-group">
           <a id="purchasability-btn" class="btn btn-primary" href="javascript:void(0)" style="margin-top:10px;margin-top:3px">Get vendors</a>
       </div>
       {% endif %}
       <div class="btn-group">
         <button id="reset_hidden_potency" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Reset columns</button>
       </div>
       <div class="btn-group">
         <button id="selectall_potency" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Select full table</button>
       </div>
       <br />
       <br />
       <div style="padding-top: 0px; font-size: 10px; white-space: nowrap;" class="scroll-container double_scroll">
           <table style="width:100%" class="display" id="proteins_potency">
               <thead id="headers_potency">
           			<tr class="header-spans">
           				<th style="text-align:left" colspan="5">Ligands (move mouse cursor over ligand name to see structure)
                     <button type="button" class="close hide_columns" columns="1,2,3,4"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                   </th>
                   <th style="border-left: 1px solid black; text-align:left" colspan="{% if ligand_query %}7{% else %}3{% endif %}" style="">Receptor
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}5,6,7,8,9,10,11{% else %}5,6,7{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                   <th style="border-left: 1px solid black; text-align:left" colspan="8">Assay information
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}12,13,14,15,16,17,18,19{% else %}8,9,10,11,12,13,14,15{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
                  <th style="border-left: 1px solid black; text-align:left" colspan="6">Chemical information
                    <button type="button" class="close hide_columns" columns="{% if ligand_query %}20,21,22,23,24,25{% else %}16,17,18,19,20,21{% endif %}"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                  </th>
           			</tr>
           			<tr class="table-filter-dropdown">
                   <th class="select-page-th"><input class="select-page" type="checkbox">Sel. page</th>
                   <th style="text-align:left">Common<br />name</th>
                   <th style="text-align:left">GPCRdb<br />ID</th>
                   <th style="text-align:left">Type<br /><br /></th>
                   <th style="text-align:left">Reference<br />ligand</th>

                   <th style="border-left: 1px solid black; text-align:left">Fold<br />selectivity</th>
                   <th style="text-align:left"># Tested<br />GPCRs</th>
                   {% if ligand_query %}
                   <th style="text-align:left">GtP<br>name</th>
                   <th style="text-align:left">UniProt<br>name</th>
                   {% endif %}
                   <th style="text-align:left">Species<br /><br /></th>
                   {% if ligand_query %}
                   <th style="text-align:left">Class<br /><br /></th>
                   <th style="text-align:left">Family<br /><br /></th>
                   {% endif %}
                   <th style="border-left: 1px solid black; text-align:left">#Vendors<br /><br /></th>
                   <th style="text-align:left">Assay<br>Type</th>
                   <th style="text-align:left">No.<br />records</th>
                   <th style="text-align:left">Min.<br /><br /></th>
                   <th style="text-align:left">Average<br /><br /></th>
                   <th style="text-align:left">Max.<br /><br /></th>
                   <th style="text-align:left">Param<br>-eter</th>
                   <th style="text-align:left">Source<br /><br /></th>
                   <th style="border-left: 1px solid black; text-align:left">Mol<br />weight</th>
                   <th style="text-align:left">Rot<br />Bonds</th>
                   <th style="text-align:left">H don<br /><br /></th>
                   <th style="text-align:left">H acc<br /><br /></th>
                   <th style="text-align:left">LogP<br /><br /></th>
                   <th style="text-align:left">Smiles<br /><br /></th>
           			</tr>
           		</thead>
               <tbody>
                   {% for record in potency_data %}
                   <tr>
                       <td><input class="alt" type="checkbox"></td>
                       <td><a class="struct struct_potency" rel="{{record.picture}}" href="/ligand/{{record.lig_id}}/info" target="_blank">{{record.ligand_name|safe}}</a></td>
                       <td align="right"><a href="/ligand/{{record.lig_id}}/info" target="_blank">{{record.lig_id}}</a></td>
                       <td>{{record.ligand_type}}</td>
                       <td>{{record.reference}}</td>

                       <td align="right">{{record.potency}}</td>
                       <td align="right">{{record.potency_tested}}</td>

                       {% if ligand_query %}
                       <td>{{record.name|safe}}</td>
                       <td>{{record.entry_name|remove_species_from_entry_name}}</td>
                       {% endif %}
                       <td>{{record.species}}</td>
                       {% if ligand_query %}
                       <td>{{record.class|safe}}</td>
                       <td>{{record.family|safe}}</td>
                       {% endif %}
                       <td align="right">{{record.purchasability}}</td>
                       <td>{{record.assay_type}}</td>
                       <td align="right">{{record.record_count}}</td>
                       <td align="right">{{record.low_value|floatformat:1}}</td>
                       <td align="right">{{record.average_value|floatformat:1}}</td>
                       <td align="right">{{record.high_value|floatformat:1}}</td>
                       <td>{{record.value_type}}</td>
                       <td>{{record.source}}</td>
                       <td align="right">{{record.mw|floatformat:0}}</td>
                       <td align="right">{{record.rotatable_bonds}}</td>
                       <td align="right">{{record.hdon}}</td>
                       <td align="right">{{record.hacc}}</td>
                       <td align="right">{{record.logp|floatformat:1}}</td>
                       <td class="dt-left">{{record.smiles}}</td>

                   </tr>
                   {% endfor %}
               </tbody>
           </table>
       </div>
    </div>
    <div class="tab-pane container" id="affinity">
      <br />
      <br />
      {% if ligand_query %}
      <div class="btn-group">
        <a class="btn btn-primary" href="/ligand/ligand_by_name" style="margin-top:10px;margin-top:3px">New Search</a>
      </div>
      {% endif %}
      <div class="btn-group">
          <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown"
                  aria-haspopup="true" aria-expanded="false" style="margin-top:10px;margin-top:3px">
              <span class="glyphicon glyphicon-download"></span> Download <span class="caret"></span>
          </button>
          <ul class="dropdown-menu">
              <li>
                  <a id="csv_btn_affinity" href="javascript:void(0)">CSV</a>
              </li>
              <li>
                  <a id="smi_btn_affinity" href="javascript:void(0)">SMILES</a>
              </li>
          </ul>
      </div>
      {% if not ligand_query %}
      <div class="btn-group">
          <a id="purchasability-btn" class="btn btn-primary" href="javascript:void(0)" style="margin-top:10px;margin-top:3px">Get vendors</a>
      </div>
      {% endif %}
      <div class="btn-group">
        <button id="reset_hidden_affinity" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Reset columns</button>
      </div>
      <div class="btn-group">
        <button id="selectall_affinity" type="button" class="btn btn-primary" style="margin-top:10px;margin-top:3px">Select full table</button>
      </div>
      <br />
      <br />
      <div style="padding-top: 0px; font-size: 10px; white-space: nowrap;" class="scroll-container double_scroll">

        <table style="width:100%" class="display" id="proteins_affinity">
            <thead id="headers_affinity">
             <tr class="header-spans">
               <th style="text-align:left" colspan="5">Ligands (move mouse cursor over ligand name to see structure)
                  <button type="button" class="close hide_columns" columns="1,2,3,4"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </th>
                <th style="border-left: 1px solid black; text-align:left" colspan="{% if ligand_query %}7{% else %}3{% endif %}" style="">Receptor
                  <button type="button" class="close hide_columns" columns="{% if ligand_query %}5,6,7,8,9,10,11{% else %}5,6,7{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </th>
                 <th style="border-left: 1px solid black; text-align:left" colspan="8">Assay information
                  <button type="button" class="close hide_columns" columns="{% if ligand_query %}12,13,14,15,16,17,18,19{% else %}8,9,10,11,12,13,14,15{% endif %}" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </th>
                <th style="border-left: 1px solid black; text-align:left" colspan="6">Chemical information
                  <button type="button" class="close hide_columns" columns="{% if ligand_query %}20,21,22,23,24,25{% else %}16,17,18,19,20,21{% endif %}"  aria-label="Close"><span aria-hidden="true">&times;</span></button>
                </th>
             </tr>
             <tr class="table-filter-dropdown">
                <th class="select-page-th"><input class="select-page" type="checkbox">Sel. page</th>
                <th style="text-align:left">Common<br />name</th>
                <th style="text-align:left">GPCRdb<br />ID</th>
                <th style="text-align:left">Type<br /><br /></th>
                <th style="text-align:left">Reference<br />ligand</th>

                <th style="border-left: 1px solid black; text-align:left">Fold<br />selectivity</th>
                <th style="text-align:left"># Tested<br />GPCRs</th>

                {% if ligand_query %}
                <th style="text-align:left">GtP<br />name</th>
                <th style="text-align:left">UniProt<br />name</th>
                {% endif %}
                <th style="text-align:left">Species<br /><br /></th>
                {% if ligand_query %}
                <th style="text-align:left">Class<br /><br /></th>
                <th style="text-align:left">Family<br /><br /></th>
                {% endif %}
                <th style="border-left: 1px solid black; text-align:left">#Vendors<br /><br /></th>
                <th style="text-align:left">Assay<br>Type</th>
                <th style="text-align:left">No.<br />records</th>
                <th style="text-align:left">Min.<br /><br /></th>
                <th style="text-align:left">Average<br /><br /></th>
                <th style="text-align:left">Max.<br /><br /></th>
                <th style="text-align:left">Param<br>-eter</th>
                <th style="text-align:left">Source<br /><br /></th>
                <th style="border-left: 1px solid black; text-align:left">Mol<br />weight</th>
                <th style="text-align:left">Rot<br />Bonds</th>
                <th style="text-align:left">H don<br /><br /></th>
                <th style="text-align:left">H acc<br /><br /></th>
                <th style="text-align:left">LogP<br /><br /></th>
                <th style="text-align:left">Smiles<br /><br /></th>
             </tr>
           </thead>
            <tbody>
                {% for record in affinity_data %}
                <tr>
                    <td><input class="alt" type="checkbox"></td>
                    <td><a class="struct struct_affinity" rel="{{record.picture}}" href="/ligand/{{record.lig_id}}/info" target="_blank">{{record.ligand_name|safe}}</a></td>
                    <td align="right"><a href="/ligand/{{record.lig_id}}/info" target="_blank">{{record.lig_id}}</a></td>
                    <td>{{record.ligand_type}}</td>
                    <td>{{record.reference}}</td>

                    <td align="right">{{record.affinity}}</td>
                    <td align="right">{{record.affinity_tested}}</td>

                    {% if ligand_query %}
                    <td>{{record.name|safe}}</td>
                    <td>{{record.entry_name|remove_species_from_entry_name}}</td>
                    {% endif %}
                    <td>{{record.species}}</td>
                    {% if ligand_query %}
                    <td>{{record.class|safe}}</td>
                    <td>{{record.family|safe}}</td>
                    {% endif %}
                    <td align="right">{{record.purchasability}}</td>
                    <td>{{record.assay_type}}</td>
                    <td align="right">{{record.record_count}}</td>
                    <td align="right">{{record.low_value|floatformat:1}}</td>
                    <td align="right">{{record.average_value|floatformat:1}}</td>
                    <td align="right">{{record.high_value|floatformat:1}}</td>
                    <td>{{record.value_type}}</td>
                    <td>{{record.source}}</td>
                    <td align="right">{{record.mw|floatformat:0}}</td>
                    <td align="right">{{record.rotatable_bonds}}</td>
                    <td align="right">{{record.hdon}}</td>
                    <td align="right">{{record.hacc}}</td>
                    <td align="right">{{record.logp|floatformat:1}}</td>
                    <td class="dt-left">{{record.smiles}}</td>

                </tr>
                {% endfor %}
            </tbody>
        </table>

      </div>
    </div>
  </div>
 {% endif %}
{% endblock %}
