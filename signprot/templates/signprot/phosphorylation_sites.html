{% extends "home/base.html" %}
{% load static %}
{% load structure_extras %}
{% load coupling_extras %}


{% block addon_css %}
    <link rel="stylesheet" href="{% static 'home/css/jquery.dataTables.min.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'home/css/signprot-multitabtable.css' %}" type="text/css"/>
{% endblock %}

{% block content %}
  <div style='width:100%; display:inline;'>
    <div class="btn-group" style="padding-left:10px;">
        
        <input class="btn btn-default btn-s" type="button" onclick="reset_tab(oTable);" value="Remove filters">
    </div>

    <div class="btn-group" style="padding-left:10px;">
      <input class="btn btn-default btn-s" type="button"
            onclick="GlobalTableToExcel('table', 'phosphorylation sites data', 'ArrestinDB_phosphorylation_sites.xls')"
            value="Excel (selection)">
      <a id="dlink" style="display:none;"></a>
      <div id="excel_table" style="display:none;"></div>
      <a href="https://files.gpcrdb.org/GPCR-G_protein_couplings.xlsx" class="btn btn-default btn-s" type="button">Excel (underlying datasets)</a>
    </div>
  </div>

<!-- tab controls  -->
<div class="container mt-3">
    <ul class="nav nav-tabs">
        {% for header, subs in headers %}
        <li class="nav-item {% if forloop.first %}active{% endif %}" data-column="{{  header.1|lower }}">
            <a class="nav-link" data-toggle="tab" href="" onclick="event.preventDefault(); showColumn('{{ header.1|lower }}')">{{ header.0|upper }}</a>
        </li>
        {%  endfor %}
    </ul>

    <!-- Data Table -->
    <table class="table" id="table">
        <thead>
            <tr>
                <!-- checkbox -->
                <th colspan="1"></th> 
                <!-- Receptor -->
                <th colspan=4 style='height:35px; text-align:left;' class="rightborder">
                Receptor
                </th>
                <!-- Phosphorylation sites -->
                <th class="main" colspan="{{ col_len }}" style='height:35px; text-align:left;' class="rightborder main">
                Phosphorylation sites
                </th>
                <!-- logMax -->
                <th colspan=13 style='height:35px; text-align:left;' class="rightborder">
                Log(Emax/EC50)
                </th>
            </tr>

            <tr class="header-center">
                <!-- checkbox holder -->
                <th></th>
                <!-- Receptor -->
                <th></th>
                <th></th>
                <th></th>
                <th></th>

                <!-- Phosphorylations -->
                {% for header, subs in headers %}
                <th class="{{ header.1|lower }}" colspan="{{ subs|length }}" style="border-right: 1px solid; text-align: center;">{{ header.0 }}</th>
                {% endfor %}
                <!-- logmax -->
                <th>arrb1</th>
                <th>arrb2</th>
                <th>arrs</th>
                <th>arrc</th>
            </tr>

            <tr>
                <!-- checkbox -->
                <th class='no-sort checkbox_tr'><input class="select-all" type="checkbox" onclick="select_all(this)"></th>
                <!-- Receptor -->
                <th style="vertical-align: middle">Uniprot</th>
                <th style="vertical-align: middle">GtoPdb</th>
                <th style="vertical-align: middle">Family</th>
                <th style="vertical-align: middle">Class</th>
                <!-- Phosphorylations -->
                {% for header, subs in headers %}
                    {% for sub in subs %}
                    <th style="text-align: center; vertical-align: middle" class="{{ header.1|lower }}">
                        {{ sub }}
                    </th>
                    {% endfor %}
                {% endfor %}
                <!-- logmax -->
                <th style="vertical-align: middle">arrb1</th>
                <th style="vertical-align: middle">arrb2</th>
                <th style="vertical-align: middle">arrs</th>
                <th style="vertical-align: middle">arrc</th>
            </tr>
            <tr>
                <th></th> <!-- checkbox -->
                <!-- Receptors -->
                <th></th>
                <th></th>
                <th></th>
                <th></th>

                <!-- Phosphorylation -->
                {% for header, subs in headers %}
                    {% for sub in subs%}
                <th class="{{ header.1|lower }}"></th><!-- Yadcf filter -->
                    {% endfor %}
                {% endfor %}

                <!-- Couplings -->
                <th></th>
                <th></th>
                <th></th>
                <th></th>

            </tr>
        </thead>
        <tbody>
            {% for row in sites %}
            <tr>
                <td class="text-center"><input class="alt" type="checkbox"></td>

                <!-- {% for el in range1 %}
                <td> {{ el }} </td>
                {% endfor %} -->

                {% for key, val in row.items %}
                    {% if key == 'icl2_seq' or key == 'icl3_seq' or key == 'c-term_seq' %}
                    <td class="truncate {{ val.1 }}"> {{ val.0 }} </td>
                    {% else %}
                    <td class="{{ val.1 }}">{{ val.0|safe }}</td>
                    {% endif %}
                {% endfor %}

                <td>ar</td>
                <td>ar</td>
                <td>ar</td>
                <td>ar</td>

            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>

{% endblock %}

{% block addon_js %}
    <script src="{% static 'home/js/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"></script>
    <script src="{% static 'home/js/select2.js' %}"></script>
    <script src="{% static 'home/js/phosphorylation_sites.js' %}"></script>
    <script src="{% static 'home/js/signprot-multitabtable.js' %}"></script>
    <script src="{% static 'home/js/xlsx.full.min.js' %}"></script>  
    <!-- {% if page == 'gprot' %}
      <script src="{% static 'home/js/gprotein_coupling_families.js' %}"></script>
    {% else %}
      <script src="{% static 'home/js/arrestin_coupling.js' %}"></script> -->
      <!-- JavaScript for Tab Functionality -->
    {% endif %}
{% endblock %}