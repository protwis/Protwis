{% extends "home/base.html" %}
{% load static %}

{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/button_spinner.css' %}" type="text/css" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.14/dist/css/bootstrap-select.min.css">
{% endblock %}


{% block content %}

  <div class="row">
    <!-- description column -->
    <div class="col-md-8">
        <!-- main description -->
        <div class="col-md-12 panel panel-primary">
            <div class="panel-body">
                <h4>{{ title }}</h4>
                {{ description|linebreaks }}
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <!-- button(s) -->

    </div>
  </div>
  <div class="row">
    <div class="col-md-8">
      <!-- target search -->
      {% if search %}
          <div class="col-md-12 panel panel-primary">
              <div class="panel-body">
                  <h4>Search</h4>
                  Search a ligand
                  <div>
                      <input id="selection-autocomplete" class="form-control" size="25">
                      <br>
                      <br>
                      by:
                      <br>
                      <select id="selection_ligand_fields" class="form-select" multiple aria-label="multiple select" style='height:120px'>
                        <option value="all">All</option>
                        <option value="name">Name</option>
                        <option value="inchikey">InChIKey</option>
                        <option value="gpcrdb_id">GPCRdb ID</option>
                        {% for lid in ligandids %}
                        <option value="{{lid.slug}}">{{ lid.name }} ID</option>
                        {% endfor %}
                      </select>
                      
                  </div>
              </div>    
          </div>
      {% endif %}
    </div>
  </div>  
  <div class="row">
    <div class="col-md-8">
      <!-- target search -->
      {% if search %}
      <div class="col-md-12 panel panel-primary">
        <div class="panel-body">
          <h4>Batch search</h4>
          Search ligands by multiple SMILES exact match or by InChIKeys (one line per ligand).
          <br>
          <div class="form-group">
            <select id="selection_ligand_bulk_search_search_type" class="form-select" aria-label="select">
              <option {% if selection_ligand_bulk_search_parameters.search_type == 'smiles' %}selected {% endif %}value="smiles">Search by SMILES</option>
              <option {% if selection_ligand_bulk_search_parameters.search_type == 'inchikey' %}selected {% endif %}value="inchikey">Search by InChIKeys</option>
            </select>          
          </div>
          <div style="{% if selection_ligand_bulk_search_parameters.search_type != 'smiles' %}display:none;{% endif %}height:44px" id="selection_ligand_bulk_search_stereo_div" class="form-group">
            <input type="checkbox" {% if selection_ligand_bulk_search_parameters.stereochemistry %}checked {% endif %}id="selection_ligand_bulk_search_stereochemistry" value="True">
          <label for="selection_ligand_bulk_search_stereochemistry">Stereochemistry<label>
          </div>
          <div class="form-group">
            <textarea class="form-control" id="selection_ligand_bulk_search_textarea" placeholder="Type or paste your SMILES or InChIKeys here.">{{ selection_ligand_bulk_search_parameters.search_text }}</textarea>
          </div>
          <div class="form-group">
            <p style="{% if ligand_bulk_search_error_msg != 'No results found.'%}color: red; {% endif %}">{{ ligand_bulk_search_error_msg }}</p>
          </div>
          <div id="selection-buttons">
            {% include 'common/selection_buttons.html' %}
          </div>
        </div>
      </div>
      {% endif %}
    </div>
  </div>
  {% if buttons.continue.label %}

  {% endif %}
{% endblock %}

{% block addon_js %}
    <meta name="csrf-token" content="{{ csrf_token }}">
    <script type="text/javascript">
        var selection_ligand_fields = '';
        var selection_ligand_fields_min_length_1 = false; // set $("#selection-autocomplete").catcomplete(minLength:1)
        $(document).ready(function() {
          $('#selection_ligand_fields').change(function () {
            var selection_ligand_fields_list = []
            $('#selection_ligand_fields option:selected').each(function( index ) {
              selection_ligand_fields_list.push($( this ).val());
            });
            if (selection_ligand_fields_list.length > 0) {
              if (selection_ligand_fields_list.indexOf('all') > -1 || selection_ligand_fields_list.indexOf('name') > -1 || selection_ligand_fields_list.indexOf('inchikey') > -1) {
                selection_ligand_fields_min_length_1 = false;
              } else {
                selection_ligand_fields_min_length_1 = true;
              }
            } else {
              selection_ligand_fields_min_length_1 = false;
            }

            selection_ligand_fields = selection_ligand_fields_list.join(',');
            $("#selection-autocomplete").catcomplete('destroy');
            selectionAutocompleteCreateCatComplete();
            console.log(selection_ligand_fields);
          });
        });
        var type_of_selection = '{{ type_of_selection }}';
        var selection_only_receptors = '{{ selection_only_receptors }}';
        var redirect_url = '{{ buttons.continue.url }}'
        var redirect_on_select = '{{ redirect_on_select }}'
    </script>
    <script src="{% static 'home/js/selection-autocomplete.js' %}"></script>
    <script src="{% static 'home/js/selection-filters.js' %}"></script>
    <script src="{% static 'home/js/selection.js' %}"></script>

    <script src="{% static 'home/js/jquery.dataTables.min.js' %}"> </script>
    <script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
    <script src="{% static 'home/js/select2.js' %}"> </script>

    <!-- Target select modal table -->
    <script type="text/javascript" src="{% static 'home/js/targetselect_functions.js' %}"> </script>

    <script type="text/javascript" src="{% static 'home/js/ligand_structural_search.js' %}"> </script>

    <script>
        const csrf_token = "{{ csrf_token }}";

  


        {% if filter_tableselect %}
        $(document).ready(function() {
            // Get Receptor Targets for table build
            initializeTargetChooserTables();

            $('#targetselect-modal-table').on('shown.bs.modal', function (e) {
                showTARGETtable('#targetselect-modal-table');
            })


            $('#targetselect-modal-table').on('hidden.bs.modal', AddMultipleTargets);

        });
        {% endif %}
        $(document).ready(function() {
            $('#selection_ligand_bulk_search_search_type').on('change',function (e) {
              if (this.value === 'inchikey') {
                    $('#selection_ligand_bulk_search_stereo_div').hide();
              } else if (this.value === 'smiles') {
                    $('#selection_ligand_bulk_search_stereo_div').show();
              }
                  
            });
        });

    </script>
{% endblock %}
